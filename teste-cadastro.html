<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Cadastro</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .form-group {
            margin: 10px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste de Cadastro</h1>
        
        <div class="test-section info">
            <h3>Status do Sistema</h3>
            <p id="systemStatus">Verificando...</p>
        </div>

        <div class="test-section">
            <h3>Teste R√°pido de Cadastro</h3>
            <button onclick="testarCadastroRapido()">Criar Usu√°rio de Teste</button>
            <div id="cadastroRapidoResult"></div>
        </div>

        <div class="test-section">
            <h3>Cadastro Manual</h3>
            <form id="testForm">
                <div class="form-group">
                    <label>Nome:</label>
                    <input type="text" id="nome" value="Jo√£o Silva" required>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="email" value="joao.silva@teste.com" required>
                </div>
                <div class="form-group">
                    <label>CPF:</label>
                    <input type="text" id="cpf" value="123.456.789-10" required>
                </div>
                <div class="form-group">
                    <label>Telefone:</label>
                    <input type="text" id="telefone" value="(61) 99999-9999">
                </div>
                <div class="form-group">
                    <label>Cargo:</label>
                    <select id="cargo" required>
                        <option value="">Selecione...</option>
                        <option value="professor">Professor</option>
                        <option value="coordenador">Coordenador</option>
                        <option value="secretaria">Secretaria</option>
                        <option value="admin">Administrador</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Senha:</label>
                    <input type="password" id="senha" value="123456" required>
                </div>
                <button type="submit">Cadastrar</button>
            </form>
            <div id="cadastroManualResult"></div>
        </div>

        <div class="test-section">
            <h3>Testar Login com Conta Criada</h3>
            <button onclick="testarLogin()">Testar Login</button>
            <div id="loginResult"></div>
        </div>

        <div class="test-section">
            <h3>Usu√°rios Cadastrados</h3>
            <button onclick="listarUsuarios()">Listar Usu√°rios</button>
            <div id="usuariosList"></div>
        </div>
    </div>

    <!-- Sistema de Banco Local -->
    <script src="js/local-database.js"></script>

    <script>
        // Verificar status do sistema
        function verificarSistema() {
            const status = document.getElementById('systemStatus');
            
            if (typeof localDB !== 'undefined') {
                const usuarios = localDB.getAll('usuarios');
                status.innerHTML = `‚úÖ Banco local funcionando<br>‚úÖ ${usuarios.length} usu√°rios cadastrados`;
                status.parentElement.className = 'test-section success';
            } else {
                status.innerHTML = '‚ùå Banco local n√£o carregado';
                status.parentElement.className = 'test-section error';
            }
        }

        // Teste r√°pido de cadastro
        async function testarCadastroRapido() {
            const result = document.getElementById('cadastroRapidoResult');
            result.innerHTML = 'Criando usu√°rio de teste...';
            
            try {
                const novoUsuario = {
                    nome: 'Usu√°rio Teste',
                    email: 'teste@exemplo.com',
                    cpf: '000.000.000-01',
                    telefone: '(61) 99999-0001',
                    cargo: 'professor',
                    senha: 'teste123'
                };

                // Verificar se j√° existe
                const usuarios = localDB.getAll('usuarios');
                const existe = usuarios.find(u => u.email === novoUsuario.email);
                
                if (existe) {
                    result.innerHTML = '<div class="info">‚ÑπÔ∏è Usu√°rio de teste j√° existe</div>';
                } else {
                    localDB.create('usuarios', novoUsuario);
                    result.innerHTML = '<div class="success">‚úÖ Usu√°rio de teste criado com sucesso!</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        }

        // Cadastro manual
        document.getElementById('testForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const result = document.getElementById('cadastroManualResult');
            result.innerHTML = 'Cadastrando...';
            
            try {
                const dados = {
                    nome: document.getElementById('nome').value,
                    email: document.getElementById('email').value,
                    cpf: document.getElementById('cpf').value,
                    telefone: document.getElementById('telefone').value,
                    cargo: document.getElementById('cargo').value,
                    senha: document.getElementById('senha').value
                };

                // Verificar se j√° existe
                const usuarios = localDB.getAll('usuarios');
                const emailExiste = usuarios.find(u => u.email === dados.email);
                const cpfExiste = usuarios.find(u => u.cpf === dados.cpf);
                
                if (emailExiste) {
                    result.innerHTML = '<div class="error">‚ùå Email j√° cadastrado</div>';
                } else if (cpfExiste) {
                    result.innerHTML = '<div class="error">‚ùå CPF j√° cadastrado</div>';
                } else {
                    localDB.create('usuarios', dados);
                    result.innerHTML = '<div class="success">‚úÖ Usu√°rio cadastrado com sucesso!</div>';
                    
                    // Limpar formul√°rio
                    document.getElementById('testForm').reset();
                }
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        });

        // Testar login
        async function testarLogin() {
            const result = document.getElementById('loginResult');
            result.innerHTML = 'Testando login...';
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'teste@exemplo.com',
                        password: 'teste123'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `<div class="success">‚úÖ Login funcionando!<br>Usu√°rio: ${data.nome}</div>`;
                } else {
                    result.innerHTML = `<div class="error">‚ùå Erro no login: ${data.error}</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        }

        // Listar usu√°rios
        function listarUsuarios() {
            const result = document.getElementById('usuariosList');
            
            try {
                const usuarios = localDB.getAll('usuarios');
                
                if (usuarios.length === 0) {
                    result.innerHTML = '<div class="info">‚ÑπÔ∏è Nenhum usu√°rio cadastrado</div>';
                } else {
                    const lista = usuarios.map(u => 
                        `<div style="margin: 5px 0; padding: 10px; background: #f8f9fa; border-radius: 3px;">
                            <strong>${u.nome}</strong><br>
                            Email: ${u.email}<br>
                            Cargo: ${u.cargo}<br>
                            Status: ${u.status}
                        </div>`
                    ).join('');
                    
                    result.innerHTML = `<div class="success">‚úÖ ${usuarios.length} usu√°rios encontrados:<br>${lista}</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                verificarSistema();
            }, 1000);
        });
    </script>
</body>
</html>